@startuml
scale 2048 height
title 学生成績処理システム

start
:システム起動;
:成績データベースに接続;
:学生リストを読み込み;
:総合成績リストを初期化;
:合格者数 = 0, 不合格者数 = 0;
:学生インデックス i = 0;

while (i < 学生数?) is (はい)
  :学生[i]の情報を取得;
  :学生[i]の科目リストを取得;
  :合計点数 = 0;
  :科目数カウンター = 0;
  :科目インデックス j = 0;
  
  while (j < 科目数?) is (はい)
    :科目[j]の点数を取得;
    
    if (点数が有効範囲内?) then (いいえ)
      :エラーログに記録;
      :点数を0として処理;
    else (はい)
    endif
    
    :合計点数に加算;
    :科目数カウンターを増加;
    :j = j + 1;
  endwhile (いいえ)
  
  :平均点を計算;
  
  if (科目数カウンター > 0?) then (はい)
    :平均点 = 合計点数 / 科目数;
    
    if (平均点 >= 60?) then (はい)
      :評価 = "合格";
      :合格者数を増加;
      
      if (平均点 >= 90?) then (はい)
        :成績評価 = "優";
      else if (平均点 >= 80?) then (はい)
        :成績評価 = "良";
      else if (平均点 >= 70?) then (はい)
        :成績評価 = "可";
      else (はい)
        :成績評価 = "可";
      endif
      
    else (いいえ)
      :評価 = "不合格";
      :不合格者数を増加;
      :成績評価 = "不可";
    endif
    
  else (いいえ)
    :エラー: 科目データなし;
    :評価 = "データ不足";
  endif
  
  :学生[i]の結果を総合成績リストに追加;
  :i = i + 1;
endwhile (いいえ)

:合格率を計算;
:統計レポートを生成;
:結果をファイルに出力;
:管理者に通知メールを送信;
:処理完了ログを記録;
stop

@enduml
